{%- comment -%}
card-thumb.html
Reusable card component for Travel/Stories grids.

Expected inputs (passed via {% include %}):
  - url:       Link to the post (e.g., post.url)
  - title:     Card title (e.g., post.title)
  - dek:       Optional short description (e.g., post.dek)
  - location:  Optional place label (e.g., post.location)
  - alt:       Alt text for the image (fallbacks to title)

  - img_src:       Default image src (preferred)
  - img_src_640:   Optional responsive source (~640w)
  - img_src_960:   Optional responsive source (~960w)
  - img_src_1280:  Optional responsive source (~1280w)
{%- endcomment -%}

{%- assign href      = include.url | relative_url -%}
{%- assign alt_text  = include.alt | default: include.title | escape -%}

{%- comment -%} Normalize any lingering /assets/images/ â†’ /assets/img/ {%- endcomment -%}
{%- assign src_main  = include.img_src      | replace: '/assets/images/', '/assets/img/' -%}
{%- assign src_640   = include.img_src_640  | replace: '/assets/images/', '/assets/img/' -%}
{%- assign src_960   = include.img_src_960  | replace: '/assets/images/', '/assets/img/' -%}
{%- assign src_1280  = include.img_src_1280 | replace: '/assets/images/', '/assets/img/' -%}

{%- comment -%} Fallback chain for the <img> src {%- endcomment -%}
{%- assign img_src_final = src_main | default: src_960 | default: src_640 -%}

<a href="{{ href }}" class="card-thumb">
  <figure class="card-thumb__media">
    <picture>
      {%- if src_1280 and src_1280 != '' -%}
        <source srcset="{{ src_1280 | relative_url }}" media="(min-width: 1024px)" type="image/jpeg">
      {%- endif -%}
      {%- if src_960 and src_960 != '' -%}
        <source srcset="{{ src_960  | relative_url }}" media="(min-width: 720px)" type="image/jpeg">
      {%- endif -%}
      {%- if src_640 and src_640 != '' -%}
        <source srcset="{{ src_640  | relative_url }}" media="(min-width: 480px)" type="image/jpeg">
      {%- endif -%}

      {#-- Final fallback <img> (always rendered) --#}
      <img
        src="{{ img_src_final | relative_url }}"
        alt="{{ alt_text }}"
        loading="lazy"
        width="960"
        height="600"
      />
    </picture>

    {%- if include.location -%}
      <figcaption class="card-thumb__label">{{ include.location }}</figcaption>
    {%- endif -%}
  </figure>

  <div class="card-thumb__body">
    <h3 class="card-thumb__title">{{ include.title }}</h3>
    {%- if include.dek -%}
      <p class="card-thumb__dek">{{ include.dek }}</p>
    {%- endif -%}
  </div>
</a>
