{%- comment -%}
card-thumb.html — Reusable card for Travel/Stories grids.

Inputs (passed via {% include %}):
  url, title, dek, location, alt
  img_src, img_src_640, img_src_960, img_src_1280
{%- endcomment -%}

{%- assign alt_text = include.alt | default: include.title | escape -%}

/* Normalize any lingering /assets/images/ → /assets/img/ */
{%- assign src_main  = include.img_src      | replace: '/assets/images/', '/assets/img/' -%}
{%- assign src_640   = include.img_src_640  | replace: '/assets/images/', '/assets/img/' -%}
{%- assign src_960   = include.img_src_960  | replace: '/assets/images/', '/assets/img/' -%}
{%- assign src_1280  = include.img_src_1280 | replace: '/assets/images/', '/assets/img/' -%}

/* Final fallback chain for the <img> src */
{%- assign img_src_final = src_main | default: src_960 | default: src_640 -%}

/* ---------- OPEN A REAL ANCHOR TAG (THIS WAS THE BUG) ---------- */
<a href="{{ include.url | relative_url }}" class="card-thumb">
  <figure class="card-thumb__media">
    <picture>
      {% if src_1280 and src_1280 != '' %}
        <source srcset="{{ src_1280 | relative_url }}" media="(min-width: 1024px)">
      {% endif %}
      {% if src_960 and src_960 != '' %}
        <source srcset="{{ src_960 | relative_url }}" media    {% endif %}

      <!-- Final fallback image (ALWAYS rendered) -->
      {{ img_src_final | relative_url }}
    </picture>

    {% if include.location %}
      <figcaption class="card-thumb__label">{{ include.location }}</figcaption>
    {% endif %}
  </figure>

  <div class="card-thumb__body">
    <h3 class="card-thumb__title">{{ include.title }}</h3>
    {% if include.dek %}
      <p class="card-thumb__dek">{{ include.dek }}</p>
    {% endif %}
  </div>
</a>
